<div>
    <raid:DumpTarget @DumpPosted="go c.refreshRaids(event.Env)" :Raids="c.Raids"></raid:DumpTarget>
    <h5>Raids</h5>
    <table class="table">
        <thead class="thead-dark">
        <th scope="row"></th>
        <th scope="row">Date</th>
        <th scope="row">Size</th>
        <th scope="row" style="width:100%;">Description</th>
        <th scope="row">Value</th>
        <th scope="row"></th>
        </thead>
        <tbody>
            <tr :style="rowStyle(tableEntry.idx)" vg-for='_, tableEntry := range c.generateTableEntries()' vg-key='tableEntry.raid.GetRaidId()'>
                <td vg-if="tableEntry.mainLine">
                    <span vg-if="c.isRaidCollapsed(tableEntry.raid.GetRaidId())" tabindex="0"
                          @click="c.toggleCollapsed(event, tableEntry.raid.GetRaidId())"
                          style="font-family:Segoe UI Symbol; cursor: pointer;">&#x25b6;</span>
                    <span vg-if="!c.isRaidCollapsed(tableEntry.raid.GetRaidId())" tabindex="0"
                          @click="c.toggleCollapsed(event, tableEntry.raid.GetRaidId())"
                          style="font-family:Segoe UI Symbol; cursor: pointer;">&#x25bc;</span>
                </td>
                <td class="text-nowrap" vg-content='util.FormatTimestamp(tableEntry.raid.GetTimestamp())' vg-if="tableEntry.mainLine"></td>
                <td vg-content='fmt.Sprint(len(tableEntry.raid.GetAttendees()))' vg-if="tableEntry.mainLine"></td>
                <td class="text-nowrap" vg-if="tableEntry.mainLine">
                    <ui:EditLabel
                            :Value='tableEntry.raid.GetDescription()'
                            :Editable="localprofile.IsAdmin()"
                            @Submit="c.updateDescription(event, tableEntry.raid)"
                    />
                </td>
                <td class="text-nowrap text-right" vg-if="tableEntry.mainLine">
                    <ui:EditLabel
                            :Value='fmt.Sprintf("%.1f", tableEntry.raid.GetDKPValue())'
                            :Editable="localprofile.IsAdmin()"
                            EditStyle="width: 4rem;"
                            @Submit="c.updateDKP(event, tableEntry.raid)"
                    />
                </td>
                <td class="text-nowrap" vg-if="tableEntry.mainLine">
                    <a href="#" title="Remove" vg-if="localprofile.IsAdmin()" @click="c.deleteRaid(event, tableEntry.raid)">&#x1F5D1;</a>
                    <a href="#" title="Recalculate" vg-if="localprofile.IsAdmin()" @click="c.recalculateRaid(event, tableEntry.raid)"><b>&#x27f3;</b></a>
                </td>

                <td vg-if="!tableEntry.mainLine">&nbsp;</td>
                <td vg-if="!tableEntry.mainLine" colspan="5">
                    <div>
                        <b>Credited:</b>
                        <div class="container-fluid">
                            <div class="row" vg-for="i:=0;i<len(tableEntry.credited);i+=6">
                                <div class="col-sm-2" vg-for="j:=i;j<len(tableEntry.credited) && j<i+6;j++">
                                    <a :href='"#member:"+tableEntry.credited[j]'
                                   vg-content="tableEntry.credited[j]"></a>
                                    <a vg-if="localprofile.IsAdmin()" href="#" @click="c.removeAttendee(event, tableEntry.raid, tableEntry.credited[j])">&#x274c;</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <b>Uncredited:</b>
                        <div class="container-fluid">
                            <div class="row" vg-for="i:=0;i<len(tableEntry.uncredited);i+=6">
                                <div class="col-sm-2" vg-for="j:=i;j<len(tableEntry.uncredited) && j<i+6;j++">
                                    <span vg-content="tableEntry.uncredited[j]"></span>
                                    <a vg-if="localprofile.IsAdmin()" href="#" @click="c.removeAttendee(event, tableEntry.raid, tableEntry.uncredited[j])">&#x274c;</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" vg-if="localprofile.IsAdmin()">
                        <label class="col-form-label col-1">Add:</label>
                        <ui:AutoComplete class="col-10"
                                         EditStyle="width:100%;"
                                         :Value="c.proposedAddition(tableEntry.raid)"
                                         @Suggestion="c.suggestMembers(event)"
                                         @Change="c.updateProposedAddition(tableEntry.raid, event)">
                        </ui:AutoComplete>
                        <a href="#" class="col-1" title="Add" @click="c.addAttendee(event, tableEntry.raid)">&#x2795;</a>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<script type="application/x-go">
import (
    "fmt"
    "github.com/GontikR99/chillmodeinfo/cmd/webapp/ui"
    "github.com/GontikR99/chillmodeinfo/internal/profile/localprofile"
    "github.com/GontikR99/chillmodeinfo/internal/util"
)
</script>